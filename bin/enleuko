#!/bin/sh
#set -x

export TERM=
export TMP=/tmp

prog=`basename $0`
url='mms://enleuko.live24.gr/enleuko877'
pipe=$TMP/$prog.$$
output=$TMP/"`date +'Τζούμας %d-%b-%Y.mp3'`"
name='Κωνσταντίνος Τζούμας'
album='Εν Λευκώ'
duration=2h

mkfifo $pipe
lame --silent -m s -q 2 -b 64 --add-id3v2 --ty 2009 --tn '1/1' --tg 'Podcast' $pipe "$output" &
lamepid=$!
mplayer -really-quiet -nocache -vo null -vc dummy -ao pcm:file=$pipe "$url" &
mplayerpid=$!
sleep $duration
kill $lamepid $mplayerpid
rm $pipe
mv "$output" ~/Dropbox/Public &&
rm ~/Dropbox/Public/"`date -d '7 days ago' +'Τζούμας %d-%b-%Y.mp3'`"
