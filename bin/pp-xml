#!/usr/bin/env python
# vim: enc=utf-8

"""Take from: http://infix.se/2007/02/06/gentlemen-indent-your-xml"""

import sys
from lxml import etree

def indent(elem, level=0):
    i = "\n" + level * "  "
    if len(elem):
        if not elem.text or not elem.text.strip():
            elem.text = i + "  "
        for e in elem:
            indent(e, level+1)
            if not e.tail or not e.tail.strip():
                e.tail = i + "  "
        if not e.tail or not e.tail.strip():
            e.tail = i
    else:
        if level and (not elem.tail or not elem.tail.strip()):
            elem.tail = i

if __name__ == '__main__':
    if len(sys.argv) > 1:
        src = sys.argv[1]
    else:
        src = sys.stdin

    tree = etree.parse(src)
    indent(tree.getroot())
    tree.write(sys.stdout)

