#!/bin/bash

prog=$(basename $0)
tmp=/tmp/$prog.$$

send_mail() {
	local subject='movies to watch update'
	local to='b.alexandrou@gmail.com'
	local content="$1"

	( cat "$content"; echo; echo Τελευταία ενημέρωση στις $(date) ) |
	mail -E -s "$subject" "$to"
}

cat "$1" |
while read title
do
	curl -s -G 'https://torrentz.eu/search' --data-urlencode 'q='"$title -CAM -HDCAM -Trailer -CAMRIP" |
	grep -i -q "$title.*movies" && echo "$title"
	sleep 5
done >"$tmp"

test -s "$tmp" && send_mail "$tmp" && rm -f "$tmp"
exit 0
