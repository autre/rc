#!/bin/bash -x

prog=`basename $0`

export LANG=C
export TERM=xterm
export TMP=/tmp

test $# -eq 0 -o "$1" == "-h" && {
	echo "$prog: usage: $prog όνομα url διάρκεια"
	exit 1
}

name="$1"
url="$2"
duration="$3"
output=$TMP/$(date +"$name @ %d-%b-%Y.mp3")
old=$(date +"$name @ %d-%b-%Y.mp3" -d "7 days ago")

nohup cvlc "$url" :sout='#transcode{acodec=mp3,ab=64,scale=1,channels=2}:std{access=file,mux=dummy,dst='"$output"'}' 2>&1 >/dev/null &
nohup_pid=$!
sleep $duration
kill $nohup_pid
mv "$output" ~/Dropbox/Public && rm -f ~/Dropbox/Public/"$old"


